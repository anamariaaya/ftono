{"version":3,"sources":["admin/contracts.js"],"names":["imprimirAlerta","loader","readJSON","readLang","btnContratoDash","signContract","forEach","btn","onclick","modalContrato","async","getContrato","url","res","fetch","json","err","console","log","e","preventDefault","lang","alerts","body","document","querySelector","classList","add","divModal","createElement","modal","btnCerrar","innerHTML","cerrarModal","target","id","window","location","origin","divContrato","contrato","firmaTitulo","textContent","signature","firmaInfo","signatureInfo","formCanvas","canvas","innerWidth","width","height","style","border","backgroundColor","margin","display","ctx","getContext","fillStyle","strokeStyle","lineWidth","lineCap","isDrawing","x","y","startDrawing","touches","overflow","pageX","offsetLeft","pageY","offsetTop","offsetX","offsetY","draw","beginPath","moveTo","lineTo","stroke","stopDrawing","addEventListener","hiddenInput","type","name","clearBtn","clearRect","isCanvasBlank","sendBtn","tipo","usuario","dataset","u","canvasValidation","appendChild","remove","toDataURL","enviarImagen","context","Uint32Array","getImageData","data","buffer","some","color","datos","FormData","append","respuesta","method","resultado","reload","error"],"mappings":"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","file":"contracts.js","sourcesContent":["import { imprimirAlerta, loader, readJSON, readLang } from \"../base/funciones.js\";\r\nimport { btnContratoDash } from \"./selectores.js\";\r\n\r\nexport function signContract(){\r\n    btnContratoDash.forEach(btn => {\r\n        btn.onclick = modalContrato;\r\n    });\r\n}\r\n\r\nasync function getContrato(url){\r\n    try{\r\n        const res = await fetch(url);\r\n        const data = await res.json();  \r\n        return data;        \r\n    }catch(err){\r\n        console.log(err);\r\n    }\r\n}\r\n\r\nasync function modalContrato(e){\r\n    e.preventDefault();\r\n        \r\n    const lang = await readLang();\r\n    const alerts = await readJSON();\r\n\r\n    const body = document.querySelector('body');\r\n    body.classList.add('overlay');\r\n\r\n    const divModal = document.createElement('div');\r\n    divModal.classList.add('register');\r\n\r\n    const modal = document.createElement('div');\r\n    modal.classList.add('register__modal');\r\n\r\n    const btnCerrar = document.createElement('button');\r\n    btnCerrar.classList.add('register__btn-cerrar');\r\n    btnCerrar.innerHTML = '<i class=\"fas fa-times\"></i>';\r\n    btnCerrar.onclick = cerrarModal;\r\n\r\n    let url;\r\n    if(e.target.id === 'music'){\r\n        url = window.location.origin+'/api/filmtono/c-musical';\r\n    }else{\r\n        url = window.location.origin+'/api/filmtono/c-artistico';\r\n    }\r\n\r\n    const divContrato = document.createElement('div');\r\n\r\n    const contrato = await getContrato(url);\r\n    divContrato.innerHTML = contrato;   \r\n\r\n    const firmaTitulo = document.createElement('P');\r\n    firmaTitulo.textContent = alerts.signature[lang];\r\n    firmaTitulo.classList.add('firma');\r\n\r\n    const firmaInfo = document.createElement('P');\r\n    firmaInfo.textContent = alerts.signatureInfo[lang];\r\n    firmaInfo.classList.add('firma__info');\r\n\r\n    const formCanvas = document.createElement('form');\r\n\r\n    const canvas = document.createElement('canvas');\r\n    //find the screen width\r\n    const width = window.innerWidth;\r\n    //set the canvas width and height\r\n    if(width < 600){\r\n        canvas.width = 300;\r\n        canvas.height = 150;\r\n        }else{\r\n        canvas.width = 600;\r\n        canvas.height = 200;\r\n    }\r\n    canvas.style.border = '1px solid black';\r\n    canvas.style.backgroundColor = 'white';\r\n    canvas.style.margin = '0 auto';\r\n    canvas.style.display = 'block';\r\n    if(e.target.id === 'contrato-musical'){\r\n        canvas.id = 'canvas-musical';\r\n    }else{\r\n        canvas.id = 'canvas-artistico';\r\n    }\r\n\r\n    const ctx = canvas.getContext(\"2d\");\r\n    ctx.fillStyle = \"white\";\r\n    ctx.strokeStyle = \"black\";\r\n    ctx.lineWidth = 2;\r\n    ctx.lineCap = \"round\";\r\n\r\n    let isDrawing = false;\r\n    let x = 0;\r\n    let y = 0;\r\n\r\n    canvas.addEventListener(\"mousedown\", startDrawing);\r\n    canvas.addEventListener(\"mousemove\", draw);\r\n    canvas.addEventListener(\"mouseup\", stopDrawing);\r\n    canvas.addEventListener(\"touchstart\", startDrawing);\r\n    canvas.addEventListener(\"touchmove\", draw);\r\n    canvas.addEventListener(\"touchend\", stopDrawing);\r\n\r\n    function startDrawing(e) {\r\n    isDrawing = true;\r\n        if (e.touches) {\r\n            body.style.overflow = 'hidden';\r\n            [x, y] = [e.touches[0].pageX - e.target.offsetLeft, e.touches[0].pageY - e.target.offsetTop];\r\n        } else {\r\n            [x, y] = [e.offsetX, e.offsetY];\r\n        }\r\n    }\r\n\r\n    function draw(e) {\r\n        if (!isDrawing) return;\r\n        ctx.beginPath();\r\n        if (e.touches) {\r\n            ctx.moveTo(x, y);\r\n            ctx.lineTo(e.touches[0].pageX - e.target.offsetLeft, e.touches[0].pageY - e.target.offsetTop);\r\n            [x, y] = [e.touches[0].pageX - e.target.offsetLeft, e.touches[0].pageY - e.target.offsetTop];\r\n        } else {\r\n            ctx.moveTo(x, y);\r\n            ctx.lineTo(e.offsetX, e.offsetY);\r\n            [x, y] = [e.offsetX, e.offsetY];\r\n        }\r\n        ctx.stroke();\r\n    }\r\n    \r\n    function stopDrawing() {\r\n        body.style.overflow = 'auto';\r\n        isDrawing = false;\r\n        ctx.beginPath();\r\n    }      \r\n\r\n    function limpiar(){\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        canvas.isCanvasBlank = true;\r\n        imprimirAlerta('signValidation', 'error', firmaInfo);\r\n        sendBtn.classList.add('btn-tabs--disabled');\r\n    }\r\n\r\n    //Create hidden input to store the image\r\n    const hiddenInput = document.createElement('input');\r\n    hiddenInput.type = 'hidden';\r\n    hiddenInput.id = 'signatureInput';\r\n    hiddenInput.name = 'signatureInput';\r\n\r\n    const clearBtn = document.createElement('button');\r\n    clearBtn.classList.add('btn-contrato--optional');\r\n    clearBtn.textContent = alerts['clear'][lang];\r\n    clearBtn.onclick = limpiar;\r\n\r\n    const tipo = e.target.id;\r\n    const usuario = e.target.dataset.u;\r\n\r\n    const sendBtn = document.createElement('button');\r\n    sendBtn.classList.add('btn-tabs', 'btn-tabs--disabled');   \r\n    sendBtn.textContent = alerts['save'][lang];\r\n    sendBtn.onclick = canvasValidation(canvas, sendBtn, hiddenInput, tipo, usuario);\r\n    \r\n    formCanvas.appendChild(canvas);\r\n\r\n    modal.appendChild(btnCerrar);\r\n    modal.appendChild(divContrato);\r\n    modal.appendChild(firmaTitulo);\r\n    modal.appendChild(firmaInfo);\r\n    modal.appendChild(formCanvas);\r\n    modal.appendChild(clearBtn);\r\n    modal.appendChild(sendBtn);\r\n\r\n    divModal.appendChild(modal);\r\n    body.appendChild(divModal);\r\n}\r\n\r\nasync function canvasValidation(canvas, sendBtn, hiddenInput, tipo, usuario){\r\n    canvas.addEventListener('mouseup', () => {\r\n        if (!isCanvasBlank(canvas)) {\r\n            sendBtn.classList.remove('btn-tabs--disabled');\r\n            hiddenInput = canvas.toDataURL();\r\n            sendBtn.addEventListener('click', () => {\r\n                enviarImagen(hiddenInput, tipo, usuario);\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\nfunction isCanvasBlank(canvas) {\r\n    const context = canvas.getContext('2d');\r\n    const pixelBuffer = new Uint32Array(\r\n      context.getImageData(0, 0, canvas.width, canvas.height).data.buffer\r\n    );\r\n    return !pixelBuffer.some(color => color !== 0);\r\n}\r\n\r\nasync function enviarImagen(hiddenInput, tipo, usuario){\r\n\r\n    const datos = new FormData();\r\n    datos.append('hiddenInput', hiddenInput);\r\n    datos.append('tipo', tipo);\r\n    datos.append('usuario', usuario);\r\n\r\n    try{\r\n        const url = window.location.origin+'/api/filmtono/signature';\r\n        const respuesta = await fetch(url, {\r\n            method: 'POST',\r\n            body: datos\r\n        });\r\n\r\n        const resultado = await respuesta.json();\r\n        if(resultado.resultado){\r\n            window.location.reload();\r\n        };\r\n    }catch(error){\r\n        console.error('Error:', error);\r\n    };\r\n}\r\n\r\nfunction cerrarModal(){\r\n    const body = document.querySelector('body');\r\n    const modal = document.querySelector('.register');\r\n    body.classList.remove('overlay');\r\n    modal.remove();\r\n}"]}