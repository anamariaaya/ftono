{"version":3,"sources":["admin/perfiles.js"],"names":["btnRegistro","btnMenu","form","datosEmpresa","llenarDatos","sellos","bloquearBotones","forEach","btn","classList","add","addEventListener","modalRegistro","e","preventDefault","body","document","querySelector","divModal","createElement","modal","btnCerrar","innerHTML","onclick","cerrarModal","titulo","textContent","submit","sincronizarDatos","appendChild","datos","empresa","id_fiscal","direccion","ciudad","pais","instagram","nombre_comercial","apellido_comercial","email_comercial","tel_comercial","nombre_contable","apellido_contable","email_contable","tel_contable","apiRegistro","async","data","FormData","append","url","respuesta","fetch","method","json","resultado","statusPerfil","selloPerfil","Swal","fire","title","text","icon","then","window","location","reload","error","console","log","nombre","remove"],"mappings":"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","file":"perfiles.js","sourcesContent":["import {btnRegistro, btnMenu} from './selectores.js';\r\nimport {form} from './form.js';\r\nimport { datosEmpresa } from './Empresa.js';\r\nimport { llenarDatos } from '../base/funciones.js';\r\nimport { sellos } from './sellos.js';\r\n\r\nexport function bloquearBotones(){  \r\n    if(btnRegistro){\r\n        btnMenu.forEach(btn => {\r\n            btn.classList.add('disabled');\r\n        });\r\n        btnRegistro.addEventListener('click', modalRegistro);\r\n    }\r\n}\r\n\r\nfunction modalRegistro(e){\r\n    e.preventDefault();\r\n    const body = document.querySelector('body');\r\n    body.classList.add('overlay');\r\n\r\n    const divModal = document.createElement('div');\r\n    divModal.classList.add('register');\r\n\r\n    const modal = document.createElement('div');\r\n    modal.classList.add('register__modal');\r\n\r\n    const btnCerrar = document.createElement('button');\r\n    btnCerrar.classList.add('register__btn-cerrar');\r\n    btnCerrar.innerHTML = '<i class=\"fas fa-times\"></i>';\r\n    btnCerrar.onclick = cerrarModal;\r\n\r\n    const titulo = document.createElement('h3');\r\n    titulo.classList.add('register__titulo');\r\n    titulo.textContent = 'Completa tu registro';\r\n\r\n    const submit = document.createElement('button');\r\n    submit.classList.add('btn-submit');\r\n    submit.onclick = sincronizarDatos;\r\n    submit.textContent = 'Registrarse';\r\n\r\n    //Agregar formulario y boton al modal\r\n    modal.appendChild(btnCerrar);\r\n    modal.appendChild(titulo);\r\n    modal.appendChild(form);\r\n    modal.appendChild(submit);\r\n    divModal.appendChild(modal);\r\n    body.appendChild(divModal);\r\n}\r\n\r\nfunction sincronizarDatos(){\r\n    const datos = llenarDatos();    \r\n   //sincronizar datos con datosEmpresa\r\n    datosEmpresa.empresa = datos.empresa;\r\n    datosEmpresa.id_fiscal = datos.id_fiscal;\r\n    datosEmpresa.direccion = datos.direccion;\r\n    datosEmpresa.ciudad = datos.ciudad;\r\n    datosEmpresa.pais = datos.pais;\r\n    datosEmpresa.instagram = datos.instagram;\r\n    datosEmpresa.nombre_comercial = datos.nombre_comercial;\r\n    datosEmpresa.apellido_comercial = datos.apellido_comercial;\r\n    datosEmpresa.email_comercial = datos.email_comercial;\r\n    datosEmpresa.tel_comercial = datos.tel_comercial;\r\n    datosEmpresa.nombre_contable = datos.nombre_contable;\r\n    datosEmpresa.apellido_contable = datos.apellido_contable;\r\n    datosEmpresa.email_contable = datos.email_contable;\r\n    datosEmpresa.tel_contable = datos.tel_contable;  \r\n    apiRegistro();    \r\n}\r\n\r\nasync function apiRegistro(){\r\n    const data = new FormData();\r\n    data.append('empresa', datosEmpresa.empresa);\r\n    data.append('id_fiscal', datosEmpresa.id_fiscal);\r\n    data.append('direccion', datosEmpresa.direccion);\r\n    data.append('ciudad', datosEmpresa.ciudad);\r\n    data.append('pais', datosEmpresa.pais);\r\n    data.append('instagram', datosEmpresa.instagram);\r\n    data.append('nombre_comercial', datosEmpresa.nombre_comercial);\r\n    data.append('apellido_comercial', datosEmpresa.apellido_comercial);\r\n    data.append('email_comercial', datosEmpresa.email_comercial);\r\n    data.append('tel_comercial', datosEmpresa.tel_comercial);\r\n    data.append('nombre_contable', datosEmpresa.nombre_contable);\r\n    data.append('apellido_contable', datosEmpresa.apellido_contable);\r\n    data.append('email_contable', datosEmpresa.email_contable);\r\n    data.append('tel_contable', datosEmpresa.tel_contable);\r\n\r\n    try{\r\n        const url = 'http://localhost:3000/api/profile';\r\n        \r\n        const respuesta = await fetch(url, {\r\n            method: 'POST',\r\n            body: data\r\n        });\r\n\r\n        const resultado = await respuesta.json();\r\n\r\n        if(resultado.resultado){\r\n            statusPerfil();\r\n            selloPerfil();\r\n            Swal.fire({\r\n                title: 'Registro exitoso',\r\n                text: 'Ya puedes utilizar la plataforma',\r\n                icon: 'success'\r\n            }).then( () => {\r\n                window.location.reload();\r\n            });\r\n        };\r\n    }catch(error){\r\n        console.log(error);\r\n        Swal.fire({\r\n            title: 'Error',\r\n            text: 'Mensaje no enviado. Intenta de nuevo',\r\n            icon: 'error'\r\n        }).then( () => {\r\n            window.location.reload();\r\n        });\r\n    }\r\n}\r\n\r\nasync function statusPerfil(){\r\n    const data = new FormData();\r\n    data.append('perfil', '1');\r\n\r\n    try{\r\n        const url = 'http://localhost:3000/api/profile/status';\r\n        \r\n        const respuesta = await fetch(url, {\r\n            method: 'POST',\r\n            body: data\r\n        });\r\n\r\n        const resultado = await respuesta.json();\r\n        if(resultado.resultado){\r\n            console.log('status actualizado');\r\n        }\r\n    }catch(error){\r\n        console.log(error);\r\n    }\r\n}\r\n\r\n\r\nasync function selloPerfil(){\r\n    sellos.nombre = datosEmpresa.empresa;\r\n\r\n    const data = new FormData();\r\n    data.append('nombre', sellos.nombre);\r\n\r\n    try{\r\n        const url = 'http://localhost:3000/api/profile/sellos';\r\n        \r\n        const respuesta = await fetch(url, {\r\n            method: 'POST',\r\n            body: data\r\n        });\r\n\r\n        const resultado = await respuesta.json();\r\n\r\n        if(resultado.resultado){\r\n            console.log('sello agregado');\r\n        }\r\n    }catch(error){\r\n        console.log(error);\r\n    }\r\n}\r\n\r\nfunction cerrarModal(){\r\n    const body = document.querySelector('body');\r\n    const modal = document.querySelector('.register');\r\n    body.classList.remove('overlay');\r\n    modal.remove();\r\n}\r\n\r\n"]}